version: '3.8'  
services:  
  core:  
    image: core-image:latest  
    deploy:  
      resources:  
        limits:  
          cpus: '0.5'  
          memory: 512M  
    user: 'non-root'  
    environment:  
      - SECURE_VAR=${SECURE_VAR}  
    networks:  
      - secure_network  
    healthcheck:  
      test: ['CMD', 'curl', '-f', 'http://localhost:port']  
      interval: 1m30s  
      timeout: 10s  
      retries: 3  
  brain:  
    image: brain-image:latest  
    deploy:  
      resources:  
        limits:  
          cpus: '0.5'  
          memory: 512M  
    user: 'non-root'  
    networks:  
      - secure_network  
    healthcheck:  
      test: ['CMD', 'curl', '-f', 'http://localhost:port']  
      interval: 1m30s  
      timeout: 10s  
      retries: 3  
  sensors:  
    image: sensors-image:latest  
    deploy:  
      resources:  
        limits:  
          cpus: '0.5'  
          memory: 512M  
    user: 'non-root'  
    networks:  
      - secure_network  
    healthcheck:  
      test: ['CMD', 'curl', '-f', 'http://localhost:port']  
      interval: 1m30s  
      timeout: 10s  
      retries: 3  
  api:  
    image: api-image:latest  
    deploy:  
      resources:  
        limits:  
          cpus: '0.5'  
          memory: 512M  
    user: 'non-root'  
    networks:  
      - secure_network  
    healthcheck:  
      test: ['CMD', 'curl', '-f', 'http://localhost:port']  
      interval: 1m30s  
      timeout: 10s  
      retries: 3  
  dashboard:  
    image: dashboard-image:latest  
    deploy:  
      resources:  
        limits:  
          cpus: '0.5'  
          memory: 512M  
    user: 'non-root'  
    networks:  
      - secure_network  
    healthcheck:  
      test: ['CMD', 'curl', '-f', 'http://localhost:port']  
      interval: 1m30s  
      timeout: 10s  
      retries: 3  
  timescaledb:  
    image: timescaledb-image:latest  
    deploy:  
      resources:  
        limits:  
          cpus: '0.5'  
          memory: 512M  
    user: 'non-root'  
    networks:  
      - secure_network  
    healthcheck:  
      test: ['CMD', 'curl', '-f', 'http://localhost:port']  
      interval: 1m30s  
      timeout: 10s  
      retries: 3  
  redis:  
    image: redis:latest  
    deploy:  
      resources:  
        limits:  
          cpus: '0.5'  
          memory: 512M  
    user: 'non-root'  
    networks:  
      - secure_network  
    healthcheck:  
      test: ['CMD', 'curl', '-f', 'http://localhost:port']  
      interval: 1m30s  
      timeout: 10s  
      retries: 3  
  rabbitmq:  
    image: rabbitmq:latest  
    deploy:  
      resources:  
        limits:  
          cpus: '0.5'  
          memory: 512M  
    user: 'non-root'  
    networks:  
      - secure_network  
    healthcheck:  
      test: ['CMD', 'curl', '-f', 'http://localhost:port']  
      interval: 1m30s  
      timeout: 10s  
      retries: 3  
  prometheus:  
    image: prom/prometheus  
    deploy:  
      resources:  
        limits:  
          cpus: '0.5'  
          memory: 512M  
    user: 'non-root'  
    networks:  
      - secure_network  
    healthcheck:  
      test: ['CMD', 'curl', '-f', 'http://localhost:port']  
      interval: 1m30s  
      timeout: 10s  
      retries: 3  
  grafana:  
    image: grafana/grafana  
    deploy:  
      resources:  
        limits:  
          cpus: '0.5'  
          memory: 512M  
    user: 'non-root'  
    networks:  
      - secure_network  
    healthcheck:  
      test: ['CMD', 'curl', '-f', 'http://localhost:port']  
      interval: 1m30s  
      timeout: 10s  
      retries: 3  
networks:  
  secure_network:  
    driver: bridge  
volumes:  
  timescaledb_data:  
    driver: local  
  redis_data:  
    driver: local  
secrets:  
  my_secret:  
    external: true  
